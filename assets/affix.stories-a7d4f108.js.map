{"version":3,"file":"affix.stories-a7d4f108.js","sources":["../../../../node_modules/.pnpm/react-use@17.4.0_react-dom@18.2.0_react@18.2.0/node_modules/react-use/esm/misc/util.js","../../../../node_modules/.pnpm/react-use@17.4.0_react-dom@18.2.0_react@18.2.0/node_modules/react-use/esm/useIsomorphicLayoutEffect.js","../../../../packages/affix/src/style.ts","../../../../packages/affix/src/affix.tsx"],"sourcesContent":["export var noop = function () { };\nexport function on(obj) {\n    var args = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        args[_i - 1] = arguments[_i];\n    }\n    if (obj && obj.addEventListener) {\n        obj.addEventListener.apply(obj, args);\n    }\n}\nexport function off(obj) {\n    var args = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        args[_i - 1] = arguments[_i];\n    }\n    if (obj && obj.removeEventListener) {\n        obj.removeEventListener.apply(obj, args);\n    }\n}\nexport var isBrowser = typeof window !== 'undefined';\nexport var isNavigator = typeof navigator !== 'undefined';\n","import { useEffect, useLayoutEffect } from 'react';\nimport { isBrowser } from './misc/util';\nvar useIsomorphicLayoutEffect = isBrowser ? useLayoutEffect : useEffect;\nexport default useIsomorphicLayoutEffect;\n","import { css, SerializedStyles } from \"@emotion/react\"\nimport { AffixFixedValue, PositionValue } from \"./interface\"\n\nexport function applyFixedPosition(\n  positionValue: PositionValue,\n): SerializedStyles {\n  return css`\n    position: fixed;\n    ${positionValue.type}: ${positionValue.offset}px\n  `\n}\n\nexport function applySize(w: number, h: number): SerializedStyles {\n  return css`\n    width: ${w}px;\n    height: ${h}px;\n  `\n}\n\nexport function applyAffixFixedStyle(\n  affixFixedValue: AffixFixedValue,\n  w: number,\n  h: number,\n): SerializedStyles {\n  if (affixFixedValue.isFixed) {\n    return css`\n      ${applyFixedPosition(affixFixedValue.position)};\n      ${applySize(w, h)}\n    `\n  }\n\n  return css``\n}\n","import {\n  forwardRef,\n  useEffect,\n  useImperativeHandle,\n  useRef,\n  useState,\n} from \"react\"\nimport { isFunction, throttleByRaf } from \"@illa-design/system\"\nimport { applyBoxStyle, deleteCssProps } from \"@illa-design/theme\"\nimport { useIsomorphicLayoutEffect } from \"react-use\"\nimport { applyAffixFixedStyle, applySize } from \"./style\"\nimport { AffixProps } from \"./interface\"\nimport useMeasure from \"react-use-measure\"\n\nenum AffixStatus {\n  START,\n  DONE,\n}\n\nfunction getTargetRect(target: HTMLElement | Window): DOMRect {\n  return target !== window\n    ? (target as HTMLElement).getBoundingClientRect()\n    : ({ top: 0, bottom: window.innerHeight } as DOMRect)\n}\n\nexport const Affix = forwardRef<HTMLDivElement, AffixProps>((props, ref) => {\n  const {\n    offsetTop = 0,\n    offsetBottom,\n    target = () => window,\n    targetContainer,\n    onChange,\n    children,\n    ...rest\n  } = props\n\n  const [status, setStatus] = useState(AffixStatus.DONE)\n  const [position, setPosition] = useState<{\n    type: \"top\" | \"bottom\"\n    offset: number\n  }>({\n    type: \"top\",\n    offset: 0,\n  })\n  const [size, setSize] = useState<{ width: number; height: number }>({\n    width: 0,\n    height: 0,\n  })\n\n  const mounted = useRef(true)\n  const targetRef = useRef<HTMLElement | Window | null>(null)\n  const wrapperRef = useRef<HTMLDivElement | null>(null)\n  const lastIsFixed = useRef(false)\n\n  const [measureWrapperRef, measureWrapperInfo] = useMeasure()\n  const [measureAffixRef, measureAffixInfo] = useMeasure()\n\n  const setWrapperRefs = (el: HTMLDivElement) => {\n    // for size measure\n    measureWrapperRef(el)\n    // for position compute\n    wrapperRef.current = el\n  }\n\n  const updatePosition = throttleByRaf(() => {\n    /*\n     * check is mounted to avoid:\n     * Warning: Can't perform a React state update on an unmounted component.\n     */\n    mounted.current && setStatus(AffixStatus.START)\n  })\n\n  useImperativeHandle(ref, () => wrapperRef?.current as HTMLDivElement, [])\n\n  useEffect(() => {\n    mounted.current = true\n    return () => {\n      mounted.current = false\n    }\n  }, [])\n\n  useEffect(() => {\n    updatePosition()\n  }, [\n    offsetTop,\n    offsetBottom,\n    target,\n    targetContainer,\n    updatePosition,\n    measureWrapperInfo,\n    measureAffixInfo,\n  ])\n\n  useEffect(() => {\n    const events = [\"scroll\", \"resize\"]\n\n    targetRef.current = target && isFunction(target) ? target() : null\n\n    if (targetRef.current) {\n      events.forEach((event) => {\n        targetRef.current?.addEventListener(event, updatePosition)\n      })\n\n      return () => {\n        events.forEach((event) => {\n          targetRef.current?.removeEventListener(event, updatePosition)\n        })\n      }\n    }\n  }, [target, updatePosition])\n\n  useEffect(() => {\n    const container =\n      targetContainer && isFunction(targetContainer) ? targetContainer() : null\n\n    if (targetRef.current !== window && container) {\n      container.addEventListener(\"scroll\", updatePosition)\n\n      return () => {\n        container.removeEventListener(\"scroll\", updatePosition)\n      }\n    }\n  }, [targetContainer, updatePosition])\n\n  useIsomorphicLayoutEffect(() => {\n    if (\n      status !== AffixStatus.START ||\n      !targetRef.current ||\n      !wrapperRef.current\n    ) {\n      return\n    }\n\n    const type = offsetBottom === undefined ? \"top\" : \"bottom\"\n    const wrapperRect = getTargetRect(wrapperRef.current)\n    const targetRect = getTargetRect(targetRef.current)\n\n    let newIsFixed\n    let offset\n\n    if (type === \"top\") {\n      newIsFixed = wrapperRect.top - targetRect.top < (offsetTop || 0)\n      offset = targetRect.top + (offsetTop || 0)\n    } else {\n      newIsFixed = targetRect.bottom - wrapperRect.bottom < (offsetBottom || 0)\n      offset = window.innerHeight - targetRect.bottom + (offsetBottom || 0)\n    }\n\n    if (newIsFixed !== lastIsFixed.current) {\n      lastIsFixed.current = newIsFixed\n      onChange && isFunction(onChange) && onChange(newIsFixed)\n    }\n\n    setStatus(AffixStatus.DONE)\n    setPosition({\n      type,\n      offset,\n    })\n    setSize({\n      width: wrapperRef.current.clientWidth,\n      height: wrapperRef.current.clientHeight,\n    })\n  })\n\n  return (\n    <div\n      ref={setWrapperRefs}\n      css={applyBoxStyle(props)}\n      {...deleteCssProps(rest)}\n    >\n      {lastIsFixed.current && (\n        <div css={applySize(size.width, size.height)}></div>\n      )}\n      <div\n        css={applyAffixFixedStyle(\n          {\n            isFixed: lastIsFixed.current,\n            position,\n          },\n          size.width,\n          size.height,\n        )}\n        ref={measureAffixRef}\n      >\n        {children}\n      </div>\n    </div>\n  )\n})\n\nAffix.displayName = \"Affix\"\n"],"names":["isBrowser","useIsomorphicLayoutEffect","useLayoutEffect","useEffect","useIsomorphicLayoutEffect$1","applyFixedPosition","positionValue","css","applySize","w","h","applyAffixFixedStyle","affixFixedValue","getTargetRect","target","Affix","forwardRef","props","ref","offsetTop","offsetBottom","targetContainer","onChange","children","rest","status","setStatus","useState","position","setPosition","size","setSize","mounted","useRef","targetRef","wrapperRef","lastIsFixed","measureWrapperRef","measureWrapperInfo","useMeasure","measureAffixRef","measureAffixInfo","setWrapperRefs","el","updatePosition","throttleByRaf","useImperativeHandle","events","isFunction","event","_a","container","type","wrapperRect","targetRect","newIsFixed","offset","jsxs","applyBoxStyle","deleteCssProps","jsx"],"mappings":"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","x_google_ignoreList":[0,1]}