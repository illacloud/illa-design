import{r as e}from"./index-1cdf6ce0.js";import{u as $,P as k,L as U,a as A,b as F}from"./use-force-update-497a924b.js";import{u as K}from"./use-isomorphic-effect-1eadbd01.js";class O extends e.Component{getSnapshotBeforeUpdate(i){const t=this.props.childRef.current;if(t&&i.isPresent&&!this.props.isPresent){const n=this.props.sizeRef.current;n.height=t.offsetHeight||0,n.width=t.offsetWidth||0,n.top=t.offsetTop,n.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function b({children:s,isPresent:i}){const t=e.useId(),n=e.useRef(null),m=e.useRef({width:0,height:0,top:0,left:0});return e.useInsertionEffect(()=>{const{width:p,height:l,top:f,left:h}=m.current;if(i||!n.current||!p||!l)return;n.current.dataset.motionPopId=t;const a=document.createElement("style");return document.head.appendChild(a),a.sheet&&a.sheet.insertRule(`
          [data-motion-pop-id="${t}"] {
            position: absolute !important;
            width: ${p}px !important;
            height: ${l}px !important;
            top: ${f}px !important;
            left: ${h}px !important;
          }
        `),()=>{document.head.removeChild(a)}},[i]),e.createElement(O,{isPresent:i,childRef:n,sizeRef:m},e.cloneElement(s,{ref:n}))}const w=({children:s,initial:i,isPresent:t,onExitComplete:n,custom:m,presenceAffectsLayout:p,mode:l})=>{const f=$(B),h=e.useId(),a=e.useMemo(()=>({id:h,initial:i,isPresent:t,custom:m,onExitComplete:r=>{f.set(r,!0);for(const u of f.values())if(!u)return;n&&n()},register:r=>(f.set(r,!1),()=>f.delete(r))}),p?void 0:[t]);return e.useMemo(()=>{f.forEach((r,u)=>f.set(u,!1))},[t]),e.useEffect(()=>{!t&&!f.size&&n&&n()},[t]),l==="popLayout"&&(s=e.createElement(b,{isPresent:t},s)),e.createElement(k.Provider,{value:a},s)};function B(){return new Map}function T(s){return e.useEffect(()=>()=>s(),[])}const d=s=>s.key||"";function D(s,i){s.forEach(t=>{const n=d(t);i.set(n,t)})}function G(s){const i=[];return e.Children.forEach(s,t=>{e.isValidElement(t)&&i.push(t)}),i}const W=({children:s,custom:i,initial:t=!0,onExitComplete:n,exitBeforeEnter:m,presenceAffectsLayout:p=!0,mode:l="sync"})=>{const f=e.useContext(U).forceRender||A()[0],h=F(),a=G(s);let r=a;const u=e.useRef(new Map).current,E=e.useRef(r),x=e.useRef(new Map).current,g=e.useRef(!0);if(K(()=>{g.current=!1,D(a,x),E.current=r}),T(()=>{g.current=!0,x.clear(),u.clear()}),g.current)return e.createElement(e.Fragment,null,r.map(o=>e.createElement(w,{key:d(o),isPresent:!0,initial:t?void 0:!1,presenceAffectsLayout:p,mode:l},o)));r=[...r];const R=E.current.map(d),I=a.map(d),M=R.length;for(let o=0;o<M;o++){const c=R[o];I.indexOf(c)===-1&&!u.has(c)&&u.set(c,void 0)}return l==="wait"&&u.size&&(r=[]),u.forEach((o,c)=>{if(I.indexOf(c)!==-1)return;const y=x.get(c);if(!y)return;const P=R.indexOf(c);let C=o;if(!C){const z=()=>{x.delete(c),u.delete(c);const L=E.current.findIndex(v=>v.key===c);if(E.current.splice(L,1),!u.size){if(E.current=a,h.current===!1)return;f(),n&&n()}};C=e.createElement(w,{key:d(y),isPresent:!1,onExitComplete:z,custom:i,presenceAffectsLayout:p,mode:l},y),u.set(c,C)}r.splice(P,0,C)}),r=r.map(o=>{const c=o.key;return u.has(c)?o:e.createElement(w,{key:d(o),isPresent:!0,presenceAffectsLayout:p,mode:l},o)}),e.createElement(e.Fragment,null,u.size?r:r.map(o=>e.cloneElement(o)))};export{W as A};
//# sourceMappingURL=index-4cd6a639.js.map
