{"version":3,"file":"back-top.stories-eedc2116.js","sources":["../../../../packages/system/src/easing.ts","../../../../packages/back-top/src/style.ts","../../../../packages/back-top/src/back-top.tsx"],"sourcesContent":["// https://github.com/LiikeJS/Liike/blob/master/src/ease.js\ninterface EasingByPower {\n  (power: number): Easing\n}\n\ninterface Easing {\n  (t: number): number\n}\n\ninterface EasingMethod {\n  [index: string]: Easing\n}\n\nconst easeInBy: EasingByPower = (power) => (t) => Math.pow(t, power)\nconst easeOutBy: EasingByPower = (power) => (t) =>\n  1 - Math.abs(Math.pow(t - 1, power))\nconst easeInOutBy: EasingByPower = (power) => (t) =>\n  t < 0.5 ? easeInBy(power)(t * 2) / 2 : easeOutBy(power)(t * 2 - 1) / 2 + 0.5\n\nconst linear: Easing = (t) => t\nconst quadIn = easeInBy(2)\nconst quadOut = easeOutBy(2)\nconst quadInOut = easeInOutBy(2)\nconst cubicIn = easeInBy(3)\nconst cubicOut = easeOutBy(3)\nconst cubicInOut = easeInOutBy(3)\nconst quartIn = easeInBy(4)\nconst quartOut = easeOutBy(4)\nconst quartInOut = easeInOutBy(4)\nconst quintIn = easeInBy(5)\nconst quintOut = easeOutBy(5)\nconst quintInOut = easeInOutBy(5)\nconst sineIn: Easing = (t) => 1 + Math.sin((Math.PI / 2) * t - Math.PI / 2)\nconst sineOut: Easing = (t) => Math.sin((Math.PI / 2) * t)\nconst sineInOut: Easing = (t) => (1 + Math.sin(Math.PI * t - Math.PI / 2)) / 2\nconst bounceOut: Easing = (t) => {\n  const s = 7.5625\n  const p = 2.75\n\n  if (t < 1 / p) {\n    return s * t * t\n  }\n  if (t < 2 / p) {\n    t -= 1.5 / p\n    return s * t * t + 0.75\n  }\n  if (t < 2.5 / p) {\n    t -= 2.25 / p\n    return s * t * t + 0.9375\n  }\n  t -= 2.625 / p\n  return s * t * t + 0.984375\n}\nconst bounceIn: Easing = (t) => 1 - bounceOut(1 - t)\nconst bounceInOut: Easing = (t) =>\n  t < 0.5 ? bounceIn(t * 2) * 0.5 : bounceOut(t * 2 - 1) * 0.5 + 0.5\n\nexport const easingMethod: EasingMethod = {\n  linear,\n\n  quadIn,\n  quadOut,\n  quadInOut,\n\n  cubicIn,\n  cubicOut,\n  cubicInOut,\n\n  quartIn,\n  quartOut,\n  quartInOut,\n\n  quintIn,\n  quintOut,\n  quintInOut,\n\n  sineIn,\n  sineOut,\n  sineInOut,\n\n  bounceIn,\n  bounceOut,\n  bounceInOut,\n}\n","import { css, SerializedStyles } from \"@emotion/react\"\n\nexport function applyFixedStyle(right: number = 40, bottom: number = 40) {\n  return css`\n    position: fixed;\n    right: ${right}px;\n    bottom: ${bottom}px;\n  `\n}\n\nexport const pointerStyle = css`\n  cursor: pointer;\n`\n\nexport function applyOpacity(visible: boolean): SerializedStyles {\n  return css`\n    opacity: ${visible ? 1 : 0};\n  `\n}\n\nexport const opacityTransition = css`\n  transition: opacity 0.2s ease-in;\n`\n","import { forwardRef, useCallback, useEffect, useRef, useState } from \"react\"\nimport { UpIcon } from \"@illa-design/icon\"\nimport { Button } from \"@illa-design/button\"\nimport {\n  throttleByRaf,\n  isFunction,\n  raf,\n  caf,\n  easingMethod,\n} from \"@illa-design/system\"\nimport { BackTopProps } from \"./interface\"\nimport {\n  applyFixedStyle,\n  applyOpacity,\n  opacityTransition,\n  pointerStyle,\n} from \"./style\"\nimport { applyBoxStyle, deleteCssProps } from \"@illa-design/theme\"\n\nexport const BackTop = forwardRef<HTMLDivElement, BackTopProps>(\n  (props, ref) => {\n    const {\n      visibleHeight = 400,\n      target = () => window,\n      easing = \"quartOut\",\n      duration = 400,\n      onClick,\n      children,\n      ...rest\n    } = props\n\n    function getScrollTarget(target: HTMLElement | Window): HTMLElement {\n      return target === window\n        ? document.documentElement\n        : (target as HTMLElement)\n    }\n\n    const [visible, setVisible] = useState(false)\n\n    const targetRef = useRef<HTMLElement | Window>()\n    const scrollTargetRef = useRef<HTMLElement>()\n\n    const scrollToTop = useCallback(() => {\n      const { scrollTop } = scrollTargetRef.current as HTMLElement\n      const startTime = Date.now()\n      let id: number\n\n      function updateScrollTopPerFrame() {\n        const nowTime = Date.now()\n        const durationFromStart = nowTime - startTime\n        const scrollTarget = scrollTargetRef.current\n\n        if (scrollTarget) {\n          scrollTarget.scrollTop =\n            scrollTop -\n            scrollTop *\n              easingMethod[easing](\n                durationFromStart > duration ? 1 : durationFromStart / duration,\n              )\n        }\n\n        durationFromStart < duration\n          ? (id = raf(updateScrollTopPerFrame))\n          : caf(id)\n      }\n\n      raf(updateScrollTopPerFrame)\n\n      isFunction(onClick) && onClick()\n    }, [duration])\n\n    useEffect(() => {\n      targetRef.current = target()\n      scrollTargetRef.current = getScrollTarget(targetRef.current)\n\n      const onScroll = throttleByRaf(() => {\n        const { scrollTop } = scrollTargetRef.current as HTMLElement\n        setVisible(scrollTop > visibleHeight)\n      })\n\n      targetRef.current.addEventListener(\"scroll\", onScroll)\n\n      return () => {\n        targetRef?.current?.removeEventListener(\"scroll\", onScroll)\n        onScroll.cancel()\n      }\n    })\n\n    const defaultChildren = (\n      <Button>\n        <UpIcon />\n      </Button>\n    )\n\n    return (\n      <div\n        css={[\n          applyFixedStyle(),\n          pointerStyle,\n          applyOpacity(visible),\n          opacityTransition,\n          applyBoxStyle(props),\n        ]}\n        ref={ref}\n        onClick={scrollToTop}\n        {...deleteCssProps(rest)}\n      >\n        {children || defaultChildren}\n      </div>\n    )\n  },\n)\n\nBackTop.displayName = \"BackTop\"\n"],"names":["easeInBy","power","easeOutBy","easeInOutBy","linear","t","quadIn","quadOut","quadInOut","cubicIn","cubicOut","cubicInOut","quartIn","quartOut","quartInOut","quintIn","quintOut","quintInOut","sineIn","sineOut","sineInOut","bounceOut","bounceIn","bounceInOut","easingMethod","applyFixedStyle","right","bottom","css","pointerStyle","applyOpacity","visible","opacityTransition","BackTop","forwardRef","props","ref","visibleHeight","target","easing","duration","onClick","children","rest","getScrollTarget","target2","setVisible","useState","targetRef","useRef","scrollTargetRef","scrollToTop","useCallback","scrollTop","startTime","id","updateScrollTopPerFrame","durationFromStart","scrollTarget","raf","caf","isFunction","useEffect","onScroll","throttleByRaf","_a","defaultChildren","jsx","Button","UpIcon","applyBoxStyle","deleteCssProps"],"mappings":"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"}