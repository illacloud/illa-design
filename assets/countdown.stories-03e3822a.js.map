{"version":3,"file":"countdown.stories-03e3822a.js","sources":["../../../../packages/statistic/src/util.ts","../../../../packages/statistic/src/countdown.tsx"],"sourcesContent":["const units: [string, number][] = [\n  [\"Y\", 1000 * 60 * 60 * 24 * 365], // years\n  [\"M\", 1000 * 60 * 60 * 24 * 30], // months\n  [\"D\", 1000 * 60 * 60 * 24], // days\n  [\"H\", 1000 * 60 * 60], // hours\n  [\"m\", 1000 * 60], // minutes\n  [\"s\", 1000], // seconds\n  [\"S\", 1], // million seconds\n]\n\n// thx ant\nexport function getDateString(millisecond: number, format: string) {\n  let leftMillisecond: number = millisecond\n  return units.reduce((current, [name, unit]) => {\n    if (current.indexOf(name) !== -1) {\n      const value = Math.floor(leftMillisecond / unit)\n      leftMillisecond -= value * unit\n      return current.replace(new RegExp(`${name}+`, \"g\"), (match: string) => {\n        const len = match.length\n        return value.toString().padStart(len, \"0\")\n      })\n    }\n    return current\n  }, format)\n}\n","import { forwardRef, useEffect, useRef, useState } from \"react\"\nimport { CountDownProps } from \"./interface\"\nimport dayjs from \"dayjs\"\nimport { getDateString } from \"./util\"\n\nimport {\n  statisticContentStyle,\n  statisticStyle,\n  statisticTitleStyle,\n} from \"./style\"\nimport { applyBoxStyle, deleteCssProps } from \"@illa-design/theme\"\n\nexport const Countdown = forwardRef<HTMLDivElement, CountDownProps>(\n  (props, ref) => {\n    const {\n      title,\n      value = 0,\n      format = \"HH:mm:ss\",\n      onFinish,\n      onChange,\n      now = dayjs(),\n      start = true,\n      valueStyle,\n      ...restProps\n    } = props\n\n    const _now = dayjs(now)\n    if (!_now.isValid()) {\n      console.warn(\"the now prop is not valid!\")\n    }\n\n    const deadline = dayjs(value) || dayjs()\n    if (!deadline.isValid()) {\n      console.warn(\"the value prop is not valid!\")\n    }\n    const [valueShow, setValueShow] = useState(\n      Math.max(deadline.diff(_now, \"millisecond\"), 0),\n    )\n    const timerRef = useRef<number | undefined>(undefined)\n    const stopTimer = () => {\n      window.clearInterval(timerRef.current)\n      timerRef.current = void 0\n    }\n\n    const startTimer = () => {\n      timerRef.current = window.setInterval(() => {\n        const _value = deadline.diff(dayjs(), \"millisecond\")\n        const valueShow = Math.max(_value, 0)\n        onChange && onChange(valueShow)\n        if (_value <= 0) {\n          stopTimer()\n          onFinish && onFinish()\n        }\n        setValueShow(valueShow)\n      }, 1000 / 30)\n    }\n\n    useEffect(() => {\n      if (!timerRef.current && start) {\n        if (deadline.valueOf() >= Date.now()) {\n          startTimer()\n        }\n      }\n      return () => {\n        stopTimer()\n      }\n    }, [start])\n    return (\n      <div\n        ref={ref}\n        css={[statisticStyle, applyBoxStyle(props)]}\n        {...deleteCssProps(restProps)}\n      >\n        {title && <div css={statisticTitleStyle}>{title}</div>}\n        <div css={statisticContentStyle} style={valueStyle}>\n          {getDateString(valueShow, format)}\n        </div>\n      </div>\n    )\n  },\n)\n\nCountdown.displayName = \"Countdown\"\n"],"names":["units","getDateString","millisecond","format","leftMillisecond","current","name","unit","value","match","len","Countdown","forwardRef","props","ref","title","onFinish","onChange","now","dayjs","start","valueStyle","restProps","_now","deadline","valueShow","setValueShow","useState","timerRef","useRef","stopTimer","startTimer","_value","valueShow2","useEffect","jsxs","statisticStyle","applyBoxStyle","deleteCssProps","jsx","statisticTitleStyle","statisticContentStyle"],"mappings":"udAAA,MAAMA,EAA4B,CAChC,CAAC,IAAK,IAAO,GAAK,GAAK,GAAK,GAAG,EAC/B,CAAC,IAAK,IAAO,GAAK,GAAK,GAAK,EAAE,EAC9B,CAAC,IAAK,IAAO,GAAK,GAAK,EAAE,EACzB,CAAC,IAAK,IAAO,GAAK,EAAE,EACpB,CAAC,IAAK,IAAO,EAAE,EACf,CAAC,IAAK,GAAI,EACV,CAAC,IAAK,CAAC,CACT,EAGgB,SAAAC,EAAcC,EAAqBC,EAAgB,CACjE,IAAIC,EAA0BF,EAC9B,OAAOF,EAAM,OAAO,CAACK,EAAS,CAACC,EAAMC,CAAI,IAAM,CAC7C,GAAIF,EAAQ,QAAQC,CAAI,IAAM,GAAI,CAChC,MAAME,EAAQ,KAAK,MAAMJ,EAAkBG,CAAI,EAC/C,OAAAH,GAAmBI,EAAQD,EACpBF,EAAQ,QAAQ,IAAI,OAAO,GAAGC,CAAI,IAAK,GAAG,EAAIG,GAAkB,CACrE,MAAMC,EAAMD,EAAM,OAClB,OAAOD,EAAM,SAAW,EAAA,SAASE,EAAK,GAAG,CAAA,CAC1C,CACH,CACO,OAAAL,GACNF,CAAM,CACX,CCZO,MAAAQ,EAAAC,EAAA,WAAkB,CAAAC,EAAAC,IAAA,CAErB,KAAA,CAAM,MAAAC,EACJ,MAAAP,EAAA,EACQ,OAAAL,EAAA,WACC,SAAAa,EACT,SAAAC,EACA,IAAAC,EAAAC,EAAA,EACY,MAAAC,EAAA,GACJ,WAAAC,EACR,GAAAC,CACG,EAAAT,EAGLU,EAAAJ,EAAAD,CAAA,EACAK,EAAA,WACE,QAAA,KAAA,4BAAA,EAGF,MAAAC,EAAAL,EAAAX,CAAA,GAAAW,EAAA,EACAK,EAAA,WACE,QAAA,KAAA,8BAAA,EAEF,KAAA,CAAAC,EAAAC,CAAA,EAAAC,EAAA,SAAkC,KAAA,IAAAH,EAAA,KAAAD,EAAA,aAAA,EAAA,CAAA,CACc,EAEhDK,EAAAC,EAAAA,OAAA,MAAA,EACAC,EAAA,IAAA,CACE,OAAA,cAAAF,EAAA,OAAA,EACAA,EAAA,QAAA,MAAmB,EAGrBG,EAAA,IAAA,CACEH,EAAA,QAAA,OAAA,YAAA,IAAA,CACE,MAAAI,EAAAR,EAAA,KAAAL,EAAA,EAAA,aAAA,EACAc,EAAA,KAAA,IAAAD,EAAA,CAAA,EACAf,GAAAA,EAAAgB,CAAA,EACAD,GAAA,IACEF,IACAd,GAAAA,EAAA,GAEFU,EAAAO,CAAA,CAAsB,EAAA,IAAA,EAAA,CACZ,EAGdC,OAAAA,EAAAA,UAAA,KACE,CAAAN,EAAA,SAAAR,GACEI,EAAA,QAAA,GAAA,KAAA,IAAA,GACEO,IAGJ,IAAA,CACED,GAAU,GACZ,CAAAV,CAAA,CAAA,EAEFe,EACE,MAAC,CAAA,IAAArB,EACC,IAAA,CAAAsB,EAAAC,EAAAxB,CAAA,CAAA,EAC0C,GAAAyB,EAAAhB,CAAA,EACd,SAAA,CAE3BP,GAAAwB,EAAA,MAAA,CAAA,IAAAC,EAAA,SAAAzB,EAAA,EAA+CwB,EAAA,MAAA,CAAA,IAAAE,EAAA,MAAApB,EAAA,SAAApB,EAAAwB,EAAAtB,CAAA,CAAA,CAAA,CAGhD,CAAA,CAAA,CACF,CAGN,EAEAQ,EAAA,YAAA;;;;"}