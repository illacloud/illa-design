import{r as e}from"./index-1cdf6ce0.js";import{u as M,P as k,w as $,a as b,L as A,b as O,c as U,e as F}from"./use-force-update-7edf8987.js";import{u as K}from"./use-isomorphic-effect-9dbdc9b0.js";class T extends e.Component{getSnapshotBeforeUpdate(i){const t=this.props.childRef.current;if(t&&i.isPresent&&!this.props.isPresent){const r=this.props.sizeRef.current;r.height=t.offsetHeight||0,r.width=t.offsetWidth||0,r.top=t.offsetTop,r.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function B({children:o,isPresent:i}){const t=e.useId(),r=e.useRef(null),m=e.useRef({width:0,height:0,top:0,left:0});return e.useInsertionEffect(()=>{const{width:f,height:a,top:c,left:h}=m.current;if(i||!r.current||!f||!a)return;r.current.dataset.motionPopId=t;const l=document.createElement("style");return document.head.appendChild(l),l.sheet&&l.sheet.insertRule(`
          [data-motion-pop-id="${t}"] {
            position: absolute !important;
            width: ${f}px !important;
            height: ${a}px !important;
            top: ${c}px !important;
            left: ${h}px !important;
          }
        `),()=>{document.head.removeChild(l)}},[i]),e.createElement(T,{isPresent:i,childRef:r,sizeRef:m},e.cloneElement(o,{ref:r}))}const y=({children:o,initial:i,isPresent:t,onExitComplete:r,custom:m,presenceAffectsLayout:f,mode:a})=>{const c=M(G),h=e.useId(),l=e.useMemo(()=>({id:h,initial:i,isPresent:t,custom:m,onExitComplete:u=>{c.set(u,!0);for(const s of c.values())if(!s)return;r&&r()},register:u=>(c.set(u,!1),()=>c.delete(u))}),f?void 0:[t]);return e.useMemo(()=>{c.forEach((u,s)=>c.set(s,!1))},[t]),e.useEffect(()=>{!t&&!c.size&&r&&r()},[t]),a==="popLayout"&&(o=e.createElement(B,{isPresent:t},o)),e.createElement(k.Provider,{value:l},o)};function G(){return new Map}const E=o=>o.key||"";function S(o,i){o.forEach(t=>{const r=E(t);i.set(r,t)})}function D(o){const i=[];return e.Children.forEach(o,t=>{e.isValidElement(t)&&i.push(t)}),i}const Y=({children:o,custom:i,initial:t=!0,onExitComplete:r,exitBeforeEnter:m,presenceAffectsLayout:f=!0,mode:a="sync"})=>{m&&(a="wait",$(!1,"Replace exitBeforeEnter with mode='wait'"));let[c]=b();const h=e.useContext(A).forceRender;h&&(c=h);const l=O(),u=D(o);let s=u;const d=new Set,w=e.useRef(s),x=e.useRef(new Map).current,C=e.useRef(!0);if(K(()=>{C.current=!1,S(u,x),w.current=s}),U(()=>{C.current=!0,x.clear(),d.clear()}),C.current)return e.createElement(e.Fragment,null,s.map(n=>e.createElement(y,{key:E(n),isPresent:!0,initial:t?void 0:!1,presenceAffectsLayout:f,mode:a},n)));s=[...s];const g=w.current.map(E),R=u.map(E),P=g.length;for(let n=0;n<P;n++){const p=g[n];R.indexOf(p)===-1&&d.add(p)}return a==="wait"&&d.size&&(s=[]),d.forEach(n=>{if(R.indexOf(n)!==-1)return;const p=x.get(n);if(!p)return;const I=g.indexOf(n),v=()=>{x.delete(n),d.delete(n);const z=w.current.findIndex(L=>L.key===n);if(w.current.splice(z,1),!d.size){if(w.current=u,l.current===!1)return;c(),r&&r()}};s.splice(I,0,e.createElement(y,{key:E(p),isPresent:!1,onExitComplete:v,custom:i,presenceAffectsLayout:f,mode:a},p))}),s=s.map(n=>{const p=n.key;return d.has(p)?n:e.createElement(y,{key:E(n),isPresent:!0,presenceAffectsLayout:f,mode:a},n)}),F!=="production"&&a==="wait"&&s.length>1&&console.warn(`You're attempting to animate multiple children within AnimatePresence, but its mode is set to "wait". This will lead to odd visual behaviour.`),e.createElement(e.Fragment,null,d.size?s:s.map(n=>e.cloneElement(n)))};export{Y as A};
//# sourceMappingURL=index-c9c44efd.js.map
